<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
    <composite:interface>

    </composite:interface>
    <composite:implementation>
        <h:form id="meal-creator">

            <div class="form-group">
                <div style="col-4">
                    <p:outputLabel for="selectedFood" value="Food: " />
                </div>
                <div style="col-4">
                    <p:autoComplete id="selectedFood" value="#{foodAddToMealController.selectedFood}"
                                    completeMethod="#{foodAddToMealController.complete}"
                                    var="food" 
                                    itemLabel="#{food.name}" 
                                    itemValue="#{food}"
                                    maxResults="5"
                                    converter="foodConverter">
                        <p:ajax event="itemSelect" listener="#{itemChangeListener.handleSelect}"
                                update="msg @this foodUpdate foodUpdate1 foodUpdate2 foodUpdate3 " />
                    </p:autoComplete>
                </div>
                <p:messages  for="selectedFood" id="msg"></p:messages>
                <h:outputLabel value="Nutriants per g/ml: " styleClass="label-style"/>
            </div>
            <div class="form-group foodInfoDetail">


                <div class="form-group detail-cell">
                    <h:outputLabel value="Calories: " styleClass="label-style"/>
                    <h:outputText id="foodUpdate1" value="#{foodAddToMealController.adjustFoodCal()}"/>
                </div>   
                <div class="form-group detail-cell">
                    <h:outputLabel value="Carbs: " styleClass="label-style"/>
                    <h:outputText id="foodUpdate2" value="#{foodAddToMealController.adjustFoodCarb()}"/>
                </div>   
                <div class="form-group detail-cell">
                    <h:outputLabel value="Protein: " styleClass="label-style"/>
                    <h:outputText id="foodUpdate3" value="#{foodAddToMealController.adjustFoodProt()}"/>
                </div> 
                <div class="form-group detail-cell">
                    <h:outputLabel value="Fat: " styleClass="label-style"/>
                    <h:outputText id="foodUpdate" styleClass="label-style" value="#{foodAddToMealController.adjustFoodFat()}"/>
                </div>

            </div>
            <div class="form-group">
                <div style="col-4">
                    <h5>Amount (g/ml): </h5>
                </div>
                <div style="col-8">
                    <p:inputNumber id="amount" required="true" value="#{foodAddToMealController.selectedFood.amount}" >
                        <p:ajax event="keyup" update="foodUpdate 
                                foodUpdate1 
                                foodUpdate2 
                                foodUpdate3"/>
                    </p:inputNumber>
                </div>
            </div>

            <div class="form-group">
                <p:commandButton action="#{mealController.addFoodToSaveList(foodAddToMealController.selectedFood)}" 
                                 value="Add food"
                                 styleClass="btn btn-success btn-block" 
                                 update="diet-plan:mealAdding:myTable diet-plan:meal-creator:amount diet-plan:meal-creator:selectedFood" 
                                 ajax="false"/>
            </div>

        </h:form>
        <h:form id="mealAdding">
            <p:outputLabel for="datetime" value="Date: " />
            <p:calendar id="datetime" required="true" value="#{mealController.date}" pattern="MM/dd/yyyy HH:mm:ss" />
            <p:dataTable id="myTable" var="food" styleClass="myDataTable" 
                         value="#{mealController.foodsInMeal}" 
                         scrollable="true" scrollHeight="150">
                <p:column headerText="Food" styleClass="smaller" footerText="Total:">
                    <h:outputText id="toUpdate1" style="smaller" value="#{food.name}" />
                </p:column>
                <p:column headerText="Calories" styleClass="smaller" footerText="#{mealController.calcTotalCalories()}">
                    <h:outputText id="toUpdate2" style="smaller" value="#{food.amount}" />
                </p:column>
                <p:column headerText="Carb" styleClass="smaller" footerText="#{mealController.calcTotalCarbs()}">
                    <h:outputText id="toUpdate3" style="smaller" value="#{food.carb * food.amount}" />
                </p:column>
                <p:column headerText="Protein" styleClass="smaller" footerText="#{mealController.calcTotalProtein()}">
                    <h:outputText id="toUpdate4" style="smaller" value="#{food.prot * food.amount}" />
                </p:column>
                <p:column headerText="Fat" styleClass="smaller" footerText="#{mealController.calcTotalFat()}">
                    <h:outputText id="toUpdate5" style="smaller" value="#{food.fat * food.amount}" />
                </p:column>
            </p:dataTable>


            <div class="form-group col-4">
                <p:commandButton id="submit-id" value="Submit" 
                                 ajax="false" 
                                 update="diet-plan:mealAdding:datetime diet-plan:mealAdding:myTable welcome" 
                                 icon="ui-icon-check" action="#{mealController.createNewMeal()}"/>
            </div>

        </h:form>

    </composite:implementation>
</html>
